{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://qud.itqan.community/schemas/layer-02-character-paired-data.json",
  "title": "Layer 2: Character Paired Data",
  "description": "Relational metadata between characters (tajweed rules requiring context, idgham relationships, etc.)",
  "type": "object",
  "required": [
    "pair_id",
    "character_1_ref",
    "character_2_ref",
    "pair_type",
    "tajweed_rule"
  ],
  "properties": {
    "pair_id": {
      "type": "string",
      "format": "uuid",
      "description": "Unique identifier for this pair relationship"
    },
    "character_1_ref": {
      "type": "string",
      "format": "uuid",
      "description": "Foreign key to Layer 0 (Character) - First character in relationship"
    },
    "character_2_ref": {
      "type": "string",
      "format": "uuid",
      "description": "Foreign key to Layer 0 (Character) - Second character in relationship"
    },
    "pair_type": {
      "type": "string",
      "enum": [
        "idgham",
        "ikhfa",
        "qalb",
        "izhar",
        "iqlab",
        "madd",
        "leen",
        "ghunnah",
        "qalqalah"
      ],
      "description": "Type of tajweed relationship between characters"
    },
    "tajweed_rule": {
      "type": "string",
      "description": "Specific tajweed rule governing this pair"
    },
    "phonetic_transformation": {
      "type": "string",
      "description": "How pronunciation changes due to pairing"
    },
    "narration_specific": {
      "type": "boolean",
      "default": false,
      "description": "Does this pairing vary by narration?"
    },
    "cross_layer_mappings": {
      "type": "object",
      "properties": {
        "layer_0_characters": {
          "type": "array",
          "items": { "type": "string", "format": "uuid" },
          "minItems": 2,
          "maxItems": 2,
          "description": "UUIDs of the two characters in this pair (2:1)"
        },
        "layer_1_symbols": {
          "type": "array",
          "items": { "type": "string", "format": "uuid" },
          "description": "UUIDs of symbols involved in this pairing"
        },
        "layer_3_word": {
          "type": "string",
          "format": "uuid",
          "description": "UUID of word containing this pair"
        }
      }
    }
  },
  "additionalProperties": false
}
