{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://qud.itqan.community/schemas/layer-08-mushaf-structure.json",
  "title": "Layer 8: Mushaf Structure",
  "description": "Complete manuscript text for each narration",
  "type": "object",
  "required": ["mushaf_id", "narration_ref", "total_verses", "total_characters"],
  "properties": {
    "mushaf_id": {
      "type": "string",
      "format": "uuid",
      "description": "Unique identifier for this mushaf instance"
    },
    "narration_ref": {
      "type": "string",
      "format": "uuid",
      "description": "Foreign key to Layer 7 (Qiraat Structure)"
    },
    "edition_ref": {
      "type": "string",
      "format": "uuid",
      "description": "Foreign key to Layer 13 (Edition Variants - optional)"
    },
    "composition_rules": {
      "type": "object",
      "description": "How layers 0-7 are composed for this mushaf",
      "properties": {
        "layer_composition": {
          "type": "array",
          "items": { "type": "integer" }
        },
        "generation_method": {
          "type": "string",
          "enum": ["extracted", "generated", "composed"]
        }
      }
    },
    "complete_text": {
      "type": "string",
      "description": "Full Quran text in this narration (derived from layers)"
    },
    "provenance": {
      "type": "string",
      "description": "Source authority (e.g., 'King Fahd Complex Hafs v2.0')"
    },
    "total_verses": {
      "type": "integer",
      "minimum": 6000,
      "description": "Total verse count for this mushaf/narration (Hafs:6236, Warsh:6214)"
    },
    "total_characters": {
      "type": "integer",
      "minimum": 300000,
      "description": "Total character count (Hafs:323015)"
    },
    "cross_layer_mappings": {
      "type": "object",
      "properties": {
        "layer_7_narration": {
          "type": "string",
          "format": "uuid"
        },
        "layer_6_surahs": {
          "type": "array",
          "items": { "type": "string", "format": "uuid" },
          "minItems": 114,
          "maxItems": 114
        },
        "layer_9_divisions": {
          "type": "array",
          "items": { "type": "string", "format": "uuid" }
        },
        "layer_10_pages": {
          "type": "array",
          "items": { "type": "string", "format": "uuid" }
        }
      }
    }
  },
  "additionalProperties": false
}
